var mpa="#modal-seleccionar-peratencion";var cld="class='col-xs-3 col-sm-2 col-md-1 panel";var parpwd;var rol;var refresh=void 0;function goTo(a,b,c,d){if("M"==a)window.location="/UndAtencion/Consumos?div="+b+"&und="+c+"&per="+d;else if("C"==a)window.location="/UndAtencion/Facturacion?div="+b+"&und="+c+"&per="+d}function getUndAtencion(a,b){$.ajax({type:"get",dataType:"json",cache:false,url:"/UndAtencion/Obtener",data:{divatencion:b},success:function(b,c,d){if("ERROR"==b.respuesta.split(":")[0])return alert(b.respuesta);a.empty();$.each(b.libres,function(b,c){var d=$("<div "+cld+" und und-libre'>"+c["DESCRIPCION"]+"</div>");d.data("codigo",c["CODIGO"]);a.append(d);d.on("click",function(){$("#und-sel").text($(this).data("codigo"));$(mpa).modal("show");$("#perate-pass").focus()})});a.append($("<div class='container row'></div>"));$.each(b.ocupadas,function(b,c){var d="S"==c["FACT"]?"und-fact":"und-ocupada";var e=$("<div "+cld+" und "+d+"'>"+c["UNDDES"]+"<br/></div>");e.data("codund",c["CODUND"]);e.data("coddiv",c["CODDIV"]);e.data("codper",c["CODPER"]);e.append($("<div class='percorto'>"+c["PERCORTO"]+"</div>"));e.on("click",function(){if(e.hasClass("und-fact"))return alert("ERROR: Acceso denegado, el consumo est\u00E1 en el proceso de facturaci\u00F3n");if("S"==parpwd){var a=$("#modal-ingresar");a.find("input").val("");a.data("codund",c["CODUND"]);a.data("coddiv",c["CODDIV"]);a.data("codper",c["CODPER"]);a.modal("show");$("#perate-pass-2").focus()}else{var b=c["CODDIV"];var d=c["CODUND"];var f=c["CODPER"];goTo(rol,b,d,f)}});a.append(e)})},error:function(a,b){errorAjax(a,b)}})}function ingresarSoloClave(){var a=$("#perate-pass-2").val();if(Validar.Dato(a)){var b=$("#modal-ingresar");b.modal("hide");var c=b.data("codund");var d=b.data("coddiv");var e=b.data("codper");aperturarUndAtencion(d,c,e,a,function(a){goTo(a.rol,a.div,a.und,a.per)})}else alert("Ingrese contraseña")}function obtenerRefresh(){$.ajax({type:"get",dataType:"json",cache:false,url:"/Parreg/TiempoRefrescoPanel",data:{},success:function(a,b,c){if("ERROR"==a.respuesta.split(":")[0])alert(a.respuesta);refresh=1e3*parseInt(a.tiempo);console.log(refresh)},error:function(a,b){errorAjax(a,b)}})}$(document).ready(function(){parpwd=$("#parpwd").text();rol=$("#rol").text();obtenerRefresh(refresh);tecladoNumerico($("input"),4);$("#divisiones li").on("click",function(){var a=$(this).data("codigo");$("#div-sel").text(a);getUndAtencion($("#divatencion-"+a),a)});$("#empleados li").on("click",function(){$(this).siblings("li").removeClass("element-active");$(this).addClass("element-active");$("#per-sel").text($(this).data("codigo"));if("S"==parpwd){var a=$("#perate-pass").val();if(Validar.Dato(a)){var b=$("#div-sel").text();var c=$("#und-sel").text();var d=$("#per-sel").text();if(!Validar.Dato(d))return alert("Seleccione una persona");$(mpa).modal("hide");aperturarUndAtencion(b,c,d,a,function(a){goTo(a.rol,a.div,a.und,a.per)})}else $("#perate-pass").focus()}else{var b=$("#div-sel").text();var c=$("#und-sel").text();var d=$("#per-sel").text();aperturarUndAtencion(b,c,d,"",function(a){goTo(rol,b,c,d)})}});$("#btn-ingresar-2").on("click",function(){ingresarSoloClave()});$("#perate-pass-2").bind("accepted",function(){ingresarSoloClave()})});