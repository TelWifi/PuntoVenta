var Form={CITEMS:0,CPRODUCTO:1,CPRECIO:2,CTIPOVV:3,CCANT:4,CSUBT:5,CBTNELI:6,CFV:0,CFP:1,CTTAR:2,CNROREF:3,CIMPORTE:4,IGV:18,Tabla:"#tabla-factura",Und:"#undatencion",Div:"#divatencion",UndDesc:"#undatencion-desc",PerDesc:"#peratencion-desc",Anexo:"#tabla-factura-anexo",GroupTipDocEmi:"#group-tipdocemi",InputGroupTDE:"input[name=tipdocemi]",BtnTipDocEmi:"active",FormAnexo:"#modal-anexo",FormSelPerAte:"#modal-seleccionar-peratencion",FormSelAnexo:"#modal-seleccionar-anexo",FormCambiarUnd:"#modal-cambiar-undatencion",SelectCambiarDiv:"#modal-cambiar-divatencion",Total:"#tabla-factura-total",Items:"#tabla-factura-items",IGV:"#tabla-factura-igv",updateTotalCheckbox:function(a,b,c){var d=0;$(a).find("tbody tr").each(function(a){if($(this).find("input[type=checkbox]").prop("checked"))d+=parseFloat($(this).find("td").get(b).innerHTML)});c.text(d.toFixed(2))},updateItemsCheckbox:function(a,b){var c=0;$(a).find("tbody tr").each(function(a){if($(this).find("input[type=checkbox]").prop("checked"))c+=1});b.text(c)},updateIGV:function(a){var b=parseFloat($(a+"-total").text());var c=b*Form.IGV/(100+Form.IGV);$(a+"-igv").text(c.toFixed(2))},getIGV:function(){$.ajax({type:"post",dataType:"json",cache:false,url:"/Parreg/ObtenerIGV",data:{},success:function(a,b,c){if(App.isError(a.respuesta))alert(a.respuesta);else if(App.isExito(a.respuesta))Form.IGV=void 0==parseFloat(a.igv)?18:parseFloat(a.igv)},error:function(a,b){errorAjax(a,b)}})},initTipDocEmi:function(){$.ajax({type:"get",dataType:"json",cache:false,url:"/Parreg/TipDocDefault",data:{},success:function(a,b,c){if(App.isExito(a.respuesta)){var d=$(Form.InputGroupTDE+"[ value='"+a.codigo+"']");d.prop("checked",true);d.parent().addClass(Form.BtnTipDocEmi)}},error:function(a,b){errorAjax(a,b)}})},getInput:function(a,b,c,d){return $("<div class='form-group'><label for='"+a+"'>"+c+"</label><input id='"+a+"' type='"+b+"' class='form-control' placeholder='"+d+"' /></div>")},getTextArea:function(a,b,c,d){return $("<div class='form-group'><label for='"+a+"'>"+b+"</label><textarea id='"+a+"' rows='"+c+"' class='form-control' placeholder='"+d+"'></textarea></div>")}};var Anexo={FormTitle:"#modal-crearane-titulo",FormBody:"#ane-body",BtnSubmit:"#modal-anexo-submit",GroupTipDoc:"#group-tipane",InputGroupTD:"input[name=tipo-cm]",BtnTipDoc:"btn-info",GroupTipPer:"#group-tipper",InputGroupTP:"input[name=ane-tipper]",BtnTipPer:"btn-success",initForm:function(a){a=null==a?$(Anexo.InputGroupTD).val():a;$(Anexo.InputGroupTD+":checked").parent().removeClass(Anexo.BtnTipDoc);$(Anexo.InputGroupTD+":checked").prop("checked",false);var b=$(Anexo.InputGroupTD+"[value='"+a+"']");b.prop("checked",true);b.parent().addClass(Anexo.BtnTipDoc);Anexo.updateForm(b)},updateForm:function(a){var b=$(Anexo.FormBody).find("#input-nrodoc").val();$(Anexo.FormBody).empty();$(Anexo.FormBody).append(Anexo.getFieldNrodoc(a.data("desc")));$(Anexo.FormBody).find("#input-nrodoc").val(b);switch(a.data("codigo")){case"01":$(Anexo.FormBody).append(Anexo.getFieldApe());$(Anexo.FormBody).append(Anexo.getFieldNombres());$(Anexo.FormBody).append(Anexo.getFieldRefane());break;case"04":$(Anexo.FormBody).append(Anexo.getFieldRS());$(Anexo.FormBody).append(Anexo.getFieldRefane());break;case"07":$(Anexo.FormBody).append(Anexo.getFieldRS());$(Anexo.FormBody).append(Anexo.getFieldRefane());break;case"06":$(Anexo.FormBody).append(Anexo.getFieldRS());$(Anexo.FormBody).append(Anexo.getFieldRefane())}if("ACT"==$(App.ControlTeclado+":checked").val()){$(Anexo.FormBody).find("input[type=text]").keyboard();$(Anexo.FormBody).find("textarea").keyboard()}"Guardar"==$(Anexo.BtnSubmit).text()||""==$(Anexo.FormBody).find("#input-nrodoc").val()?"":Anexo.getDB($(Form.Anexo),function(a){var b=$(Anexo.FormBody);b.find("#input-nrodoc").val(a.nrodoc);b.find("#input-refane").val(a.refane);null==a.apepat&&null==a.apemat?b.find("#input-ape").val(""):b.find("#input-ape").val(a.apepat+" "+a.apemat);b.find("#input-nom1").val(null==a.nombre1?"":a.nombre1);b.find("#input-nom2").val(null==a.nombre2?"":a.nombre2);b.find("#input-desane").val(null==a.desane?"":a.desane);$(Form.FormAnexo).modal("show")})},getFieldNrodoc:function(a){return Form.getInput("input-nrodoc","text",a,"INGRESE SU "+a)},getFieldRefane:function(){return Form.getTextArea("input-refane","Direcci\u00F3n",2,"Ingrese su Direcci\u00F3n")},getFieldApe:function(){return Form.getInput("input-ape","text","Apellidos","Ingrese sus apellidos")},getFieldNombres:function(){var a=$("<div class='form-group'></div>");a.append($("<div class='col-sm-6'>").append(Form.getInput("input-nom1","text","Nombre 1","Ingrese su primer nombre")));a.append($("<div class='col-sm-6'>").append(Form.getInput("input-nom2","text","Nombre 2","Ingrese su segundo nombre")));return a},getFieldRS:function(){return Form.getTextArea("input-desane","Raz\u00F3n social",2,"")},show:function(a,b){b.find(".anexo-desane").val(a.desane);b.find(".anexo-nrodoc").val(a.nrodoc);b.find(".anexo-refane").val(a.refane)},clear:function(a){Anexo.show({desane:"",nrodoc:"",refane:""},a)},get:function(a){return{desane:a.find(".anexo-desane").val(),nrodoc:a.find(".anexo-nrodoc").val(),refane:a.find(".anexo-refane").val()}},updateDB:function(a,b){if(!Validar.Anexo(a))return;$.ajax({type:"post",dataType:"json",cache:false,url:"/Anexos/Actualizar",data:{a:JSON.stringify(a)},success:function(a,c,d){if(App.isError(a.respuesta)||App.isAdvert(a.respuesta))alert(a.respuesta);else if(App.isExito(a.respuesta))Anexo.show(a.anexo,b)},error:function(a,b){errorAjax(a,b)}})},getDB:function(a,b){var c=Anexo.get(a);if(!Validar.Dato(c.nrodoc))return alert(Msg.NRODOC_INVALIDO);$.ajax({type:"post",dataType:"json",cache:false,url:"/Anexos/Obtener",data:{nrodoc:c.nrodoc},success:function(d,e,f){if(App.isError(d.respuesta))alert(d.respuesta);else if(App.isAdvert(d.respuesta)){Anexo.show({nrodoc:c.nrodoc,refane:"",desane:""},a);var g=$(Form.FormAnexo);Anexo.initForm(App.getTipNrodoc(c.nrodoc));g.find("input[type='text']").val("");g.find("input[type='text']").first().val(c.nrodoc);g.find(Anexo.FormTitle).text("Agregar Cliente");g.find(Anexo.BtnSubmit).text("Guardar");g.modal("show")}else if(App.isExito(d.respuesta)){Anexo.show(d.anexo,a);null==b?"":b(d.anexo)}},error:function(a,b){errorAjax(a,b)}})},createDB:function(a,b){if(!Validar.Anexo(a))return alert(Msg.ANEXO_INVALIDO);$.ajax({type:"get",dataType:"json",cache:false,url:"/Anexos/Crear",data:{a:JSON.stringify(a)},success:function(a,c,d){if(App.isError(a.respuesta))return alert(a.respuesta);if(App.isExito(a.respuesta)||App.isAdvert(a.respuesta))Anexo.show(a.anexo,b)},error:function(a,b){errorAjax(a,b)}})}};function resetTabla(a){$(a).find("tbody tr").remove();$(a).data("codigo","");$(a+"-items").text("-");$(a+"-igv").text("-");$(a+"-total").text("-")}function printFactura(a,b,c){var d=35;var e="<pre>{cia-desc}\n{slogan}\n\n{cia-nom}\nRUC {ruc}\nCentral: {dir-central}\n{telefono}\n{docemi}\n{cod1}-{cod2}\n</pre>";var f="<pre class='text-left'>\nTienda {tienda}\n{direccion}\n{distrito}-{departamento}\nFecha: {fecha} Hora: {hora}\n"+App.getStr("*",d)+"\nCORRELATIVO	: {correlativo}\nCAJA		: {caja}\nTIPO DE MONEDA	: {moneda}\nCLIENTE		: {cliente}\nDOC. IDENTIDAD	: {tipdoc} : {nro-doc}\n"+App.getStr("*",d)+"<table><tr><td class='text-left'>ARTICULO</td><td style='width:30px;'>CANT</td><td style='width:50px;'>PRECIO</td><td style='width:50px;'>IMPORTE</td></tr> </table>"+App.getStr("*",d)+"<table id='t-i'><thead><tr><th></th><th style='width:30px;'></th><th style='width:50px;'></th><th style='width:50px;'></th></tr></thead></table>"+App.getStr("=",d)+"<table><tr></tr><tr><td>Op. Exonerada	{abr}</td><td id='exonerada'></td></tr><tr><td>Op. Inafecta	{abr}</td><td id='inafecta'></td></tr><tr><td>Op. Gravada	{abr}</td><td id='gravada'></td></tr><tr><td>IGV		{abr}</td><td id='igv'></td></tr><tr><td>Importe Total	{abr}</td><td id='importe-total'></td></tr></table><div id='resumen'></div>\n</pre>";var g="<pre>{cod-gen}\n\nRepresentaci\u00F3n impresa del Comprobante de Venta Electr\u00F3nica, esta puede ser consultada en {pag-web} autorizado mediante resoluci\u00F3n de intendencia {resol-inten}\n\n{pag-web}\nGRACIAS POR SU COMPRA\n</pre>";var h=$("<div></div>");e=e.replace("{cia-desc}",c.cia.nombrecomercial);e=e.replace("{slogan}",c.cia.eslogan);e=e.replace("{cia-nom}",c.cia.descia);e=e.replace("{ruc}",c.cia.ruccia);e=e.replace("{dir-central}",c.cia.dircia);e=e.replace("{telefono}",c.cia.telefonos);e=e.replace("{docemi}",c.docemi);e=e.replace("{cod1}",c.cod1);e=e.replace("{cod2}",c.cod2);f=f.replace("{tienda}",c.suc.descripcion);f=f.replace("{direccion}",c.suc.direccion);f=f.replace("{distrito}",c.suc.distrito);f=f.replace("{departamento}",c.suc.departamento);f=f.replace("{fecha}",c.fecha);f=f.replace("{hora}",c.hora);f=f.replace("{correlativo}",c.venc.CODIGO);f=f.replace("{caja}",c.venc.PUNEMI);f=f.replace("{moneda}",c.moneda);f=f.replace("{cliente}",c.anexo.desane);f=f.replace("{tipdoc}",c.tipdoc);f=f.replace("{nro-doc}",c.anexo.nrodoc);f=replaceAll(f,"{abr}",c.abrevia);g=g.replace("{cod-gen}","sbdasdi832387291ad");g=replaceAll(g,"{pag-web}",c.cia.linkconsulta);g=g.replace("{resol-inten}",c.cia.resintendencia);f=$(f);var i=f.find("#t-i");a.find("tbody tr").each(function(){var a=$("<tr></tr>");a.append($("<td></td>").append($(this).find("td").get(Form.CPRODUCTO).innerHTML));a.append($("<td></td>").append($(this).find("td input[type=number]").val()));a.append($("<td></td>").append($(this).find("td").get(Form.CPRECIO).innerHTML));a.append($("<td></td>").append($(this).find("td").get(Form.CSUBT).innerHTML));i.append(a)});var j=f.find("#resumen");s="SON: "+c.totalstr+"\n";j.append(s);$.each(c.resumen,function(a,b){s=b["forventa"]+" "+b["forpago"]+" ";if(Validar.Dato(b["tarjeta"])){s+=b["tarjeta"]+" ";s+=parseFloat(b["recibido"]).toFixed(2)+" NUEVOS SOLES\n"}else s+=parseFloat(b["recibido"]).toFixed(2)+" NUEVOS SOLES\n";if(0!=parseFloat(b["vuelto"]))s+="Vuelto: "+parseFloat(b["vuelto"]).toFixed(2)+" NUEVOS SOLES\n";j.append(s)});j.append(c.cajero);f.find("#gravada").append(parseFloat(c.gravado).toFixed(2));f.find("#inafecta").append(parseFloat(c.inafecto).toFixed(2));f.find("#exonerada").append(parseFloat(c.exonerado).toFixed(2));f.find("#igv").append(parseFloat(c.igv).toFixed(2));f.find("#importe-total").append(parseFloat(c.total).toFixed(2));h.append($(e));h.append(f);h.append($(g));if(!print(h))alert(Msg.ERROR_IMPRIMIR)}function guardarFactura(a){if(!Validar.Dato(a.data("codigo")))return alert(Msg.NO_EXISTE.replace("el c\u00F3digo del consumo"));var b=a.data("codigo");var c=new Array();var d;a.find("tbody tr").each(function(a){var b=$(this);d={CANTIDAD:parseFloat(b.find("td input[type=number]").val()),CONVENTA:b.data("codigo"),ITEM:b.find("td").get(Form.CITEMS).innerHTML};c.push(d)});$.ajax({type:"post",dataType:"json",cache:false,url:"/Cond/Guardar",data:{codigo:b,items:JSON.stringify(c)},success:function(a,b,c){alert(a.respuesta)},error:function(a,b){errorAjax(a,b)}})}function obtenerDetalle(a,b,c,d,e,f){if(!Validar.Dato(a.val())||!Validar.Dato(b)||!Validar.Dato(c))return;if(!Validar.StrSoloNum(a.val()))return alert(Msg.ERROR_CAMPO_NUMERICO.replace("<attr>",Msg.UNDATENCION));$.ajax({type:"post",dataType:"json",cache:false,url:"/Cond/Obtener",data:{codund:a.val(),coddiv:b},success:function(b,g,h){resetTabla(c);clearDesc(d,e);if(App.isError(b.respuesta))alert(b.respuesta);else if(App.isExito(b.respuesta)){$(e).data("codigo",b.undatencion.CODIGO);$(e).text(b.undatencion.DESCRIPCION);$(c).data("codigo",b.cabecera.CODIGO);$(d).data("codigo",b.peratencion.codigo);$(d).text(b.peratencion.descripcion);$.each(b.lista,function(a,b){var d=App.getInputCantidad();var e=App.getBtnRemove();var f=[$(c).find("tr").length,b["DESCRIPCION"],parseFloat(b["PREUNI"]).toFixed(2),b["tipovalorventa"].substring(0,App.CARSUBSTR),d,parseFloat(b["TOTAL"]).toFixed(2),e];var g=addRow($(c),f);g.data("codigo",b["CONVENTA"]);e.on("click",function(){removeRow(g);actualizarTotal(c,Form.CSUBT);actualizarItems(c,Form.CITEMS);Form.updateIGV(c)});d.change(function(){var a=parseFloat($(this).val());if(a>0){actualizarSubtotal(g,d,Form.CPRECIO,Form.CSUBT);actualizarTotal(c,Form.CSUBT);Form.updateIGV(c)}else{$(this).val(1);alert(Msg.CANT_NO_MENOR_A.replace("<attr>","una unidad"))}});$(c).append(g)});actualizarTotal(c,Form.CSUBT);actualizarItems(c,Form.CITEMS);Form.updateIGV(c)}else if(App.isAdvert(b.respuesta))f(a)},error:function(a,b){errorAjax(a,b)}})}function agregarProducto(a){var b=Form.Tabla;var c=App.getBtnRemove();var d=App.getInputCantidad();var e=a.find(".nombre").first().text();var f=parseFloat(a.data("precio")).toFixed(2);var g=[$(b).find("tr").length,e,f,a.data("tipovv").substring(0,App.CARSUBSTR),d,f,c];var h=addRow($(b),g);h.data("codigo",a.data("codigo"));actualizarTotal(b,Form.CSUBT);actualizarItems(b,Form.CITEMS);Form.updateIGV(b);c.on("click",function(){removeRow(h);actualizarTotal(b,Form.CSUBT);actualizarItems(b,Form.CITEMS);Form.updateIGV(b)});d.change(function(){var a=parseFloat($(this).val());if(a>0){actualizarSubtotal(h,d,Form.CPRECIO,Form.CSUBT);actualizarTotal(b,Form.CSUBT);Form.updateIGV(b);Form.updateIGV(b)}else{$(this).val(1);alert(Msg.CANT_NO_MENOR_A.replace("<attr>","una unidad"))}})}function changeUndAtencion(a){if(Validar.Dato($(Form.Div).val()))if(Validar.Dato(a.val()))obtenerDetalle(a,$(Form.Div).val(),Form.Tabla,Form.PerDesc,Form.UndDesc,function(a){if(confirm(Msg.APERTURAR_UND))$(Form.FormSelPerAte).modal("show")});else alert(Msg.SELECCION_UND);else{$(this).val("");alert(Msg.SELECCION_DIV)}}var FormPago={Name:"#modal-pagar",DivP:"#modal-pagar-principal",DivS:"#modal-pagar-secundario",GroupFV:"#group-forventa",InputGroupFV:"input[name='forma-venta']",BtnFV:"btn-warning",LblFV:"#forventa",GroupFP:"#group-forpago",InputGroupFP:"input[name='forma-pago']",BtnFP:"btn-primary",LblFP:"#forpago",Importe:"#input-importe",TotalPagar:"#form-pagar-total",TotalPagado:"#forma-pago-total",Tabla:"#tabla-forma-pago",PrintPreFact:"#print-prefact",initForm:function(){$(FormPago.GroupFP).children().removeClass(FormPago.BtnFP);$(FormPago.GroupFV).children().removeClass(FormPago.BtnFV);$(FormPago.TotalPagar).text(parseFloat($(Form.Total).text()).toFixed(2));$(FormPago.TotalPagado).text("00.00");$(FormPago.Tabla).find("tbody tr").remove();var a=$(FormPago.InputGroupFV+":radio");a.first().prop("checked",true);a.first().parent().addClass(FormPago.BtnFV);$(FormPago.LblFV).text(a.first().data("desc"));$(this.PrintPreFact).prop("checked",true);this.updateForm()},updateForm:function(a){var b=$(this.InputGroupFV+":checked");var c=$(this.DivP);var d=$(this.DivS);c.empty();d.empty();$(this.Importe).val("00.00");switch(b.val()){case"C":$(this.GroupFP+", "+this.LblFP).removeClass("hide");$(this.LblFP).siblings("label").removeClass("hide");if(!Validar.Dato(a)||!Validar.Dato(a.val())){a=$(this.InputGroupFP).first();a.prop("checked",true);a.parent().addClass(this.BtnFP)}if("S"==a.data("istarjeta"))this.isTarjeta(c,d);if("S"==a.data("isreferencia"))this.isNroRef(c,d);if("S"==a.data("isefectivo"))this.isEfectivo(c,d);$(this.LblFP).text(a.data("desc"));break;case"P":$(this.GroupFP+", "+this.LblFP).addClass("hide");$(this.LblFP).siblings("label").addClass("hide");$(this.Importe).prop("disabled",false);a.prop("checked",false);a.parent().removeClass(this.BtnFP);var e=parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text());if(e>0)$(this.Importe).val(e.toFixed(2))}},isTarjeta:function(a,b){var c=$("<div class='form-group'><label>Tarjeta:</label> <label class='tarjeta'></label></div>");a.append(c);this.getTarjetas(b);var d=parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text());if(d>0)$(this.Importe).val(d.toFixed(2));$(this.Importe).attr("disabled",false)},isNroRef:function(a,b){var c=$("<input type='number' placeholder='Ingrese Nro. de referencia' class='txt-nro-ref form-control-static'>");if("ACT"==$(App.ControlTeclado+":checked").val())tecladoNumerico(c);a.append($("<div class='form-group'><label>Nro. referencia: </label></div>").append(c));var d=parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text());if(d>0)$(this.Importe).val(d.toFixed(2));$(this.Importe).attr("disabled",false)},isEfectivo:function(a,b){var c="class='btn-group btn-group-sm btn-group-justified'";html=$("<div id='denominaciones'><label>Nominaciones</label><div class='efectivo text-center'><div "+c+"><a>S/. 200</a><a>S/. 100</a><a>S/. 50</a><a>S/. 20</a></div><div "+c+"><a>S/. 10</a><a>S/. 5</a><a>S/. 2</a><a>S/. 1</a></div><div "+c+"><a>S/. 0.50</a><a>S/. 0.20</a><a>S/. 0.10</a><aux class='btn btn-danger input-reset'>Limpiar</aux></div></div></div>;");html.find("a").addClass("btn btn-secundario btn-secundario-bordes");b.append(html);a.append("<div class='form-group'><label>Vuelto: </label> <label id='lbl-vuelto'>00.00</label></div>");$(this.Importe).val("0.00");html.find("a").on("click",function(){var b=$(FormPago.Importe);var c=a.find("#lbl-vuelto");var d=parseFloat($(this).text().split(" ")[1]);var e=parseFloat(b.val());if(isNaN(e))e=0;var f=d+e;b.val(parseFloat(f).toFixed(2));var g=f-(parseFloat($(FormPago.TotalPagar).text())-parseFloat($(FormPago.TotalPagado).text())).toFixed(2);if(g>=0)c.text(g.toFixed(2))});html.find(".input-reset").on("click",function(){$(FormPago.Importe).val("00.00");a.find("#lbl-vuelto").text("00.00")});var d=parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text());if(d>0)$(this.Importe).val(d.toFixed(2));$(this.Importe).attr("disabled",true)},getTarjetas:function(a){$.ajax({type:"get",dataType:"json",cache:false,url:"/Tarjetas/Obtener",data:{},success:function(b,c,d){a.empty();if(App.isError(b.respuesta))return alert(b.respuesta);if(App.isExito(b.respuesta)){$.each(b.lista,function(b,c){var d=$('<div class="btn"></div>');d.data("desc",c["descripcion"]);d.data("codigo",c["codigo"]);var e=$('<input name="tipo-tarjeta" value="'+c["codigo"]+'" class="hide" type="radio">');var f;if(null!=c["foto64"])f=$('<img class="img-responsive img-thumbnail " src="data:image/gif;base64,'+decBase64(c["foto64"])+'" style="height:40px;" />');else d.append(c["descripcion"]);d.append(e);d.append(f);a.append(d)});a.find(".btn").on("click",function(){$(this).siblings(".btn").removeClass("btn-success");$(this).addClass("btn-success");$(this).children("input[type=radio]").prop("checked",true);a.parent().find(".tarjeta").text($(this).data("desc"));a.parent().find(".tarjeta").data("codigo",$(this).data("codigo"))})}},error:function(a,b){errorAjax(a,b)}})},add:function(){var a=$(this.InputGroupFV+":checked");var b=$(this.InputGroupFP+":checked");if(!Validar.Dato(a.val()))return alert(Msg.NO_NULO_O_VACIO.replace("<attr>","La forma de venta"));var c=$(this.Tabla);var d=new Array();var e=parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text());d.push(a.data("desc"));switch(a.val()){case"C":if("C"==a.val()&&!Validar.Dato(b.val()))return alert(Msg.NO_NULO_O_VACIO.replace("<attr>","La forma de pago"));if(e>0){d.push(b.data("desc"));var f=$(this.DivP);if("S"==b.data("istarjeta")){var g=f.find(".tarjeta");if(!Validar.Dato(g.text()))return alert("ERROR: Seleccione un tipo de tarjeta");d.push(g.text());g.text("")}else d.push("");if("S"==b.data("isreferencia")){var h=f.find(".txt-nro-ref");d.push(h.val());h.val("")}else d.push("");var i=parseFloat($(this.Importe).val().replace(",","."));if(0==i)return alert("ERROR: El Importe No puede ser 00.00");if(i>parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text()))i=parseFloat($(this.TotalPagar).text())-parseFloat($(this.TotalPagado).text());d.push(i.toFixed(2));$(this.Importe).val("00.00");var j=addRow(c,d);if("S"==b.data("isefectivo")){j.data("cambio",$("#lbl-vuelto").text());$("#lbl-vuelto").text("00.00")}else j.data("cambio","0");j.data("fv",a.data("codigo"));j.data("fp",b.val());j.data("tt",f.find(".tarjeta").data("codigo"));$(this.TotalPagado).text(sumar(c,Form.CIMPORTE).toFixed(2))}else alert("ERROR: No se puede agregar, porque el total a pagar ya coincide con la suma de los montos agregado");break;case"P":if(e>0){d.push("");d.push("");d.push("");d.push($(this.Importe).val());var j=addRow(c,d);j.data("cambio","0");$(this.TotalPagado).text(sumar(c,Form.CIMPORTE).toFixed(2));$(this.Importe).val("00.00")}else alert("ERROR: No se puede agregar, porque el total a pagar ya coincide con la suma de los montos agregado")}},aceptar:function(){var a=$(this.InputGroupFV+":checked");var b=$(this.InputGroupFP+":checked");if(parseFloat($(this.TotalPagar).text())==parseFloat($(this.TotalPagado).text())){var c=$(Form.Tabla).data("codigo");var d=Anexo.get($(Form.Anexo));var e=$(Form.InputGroupTDE+":checked").val();var f=new Array();$(this.Tabla).find("tbody tr").each(function(a){var b=$(this);var c={FORVENTA:b.data("fv"),FORPAGO:b.data("fp"),TARJETA:b.data("tt"),REFERENCIA:Validar.Dato(b.find("td").get(Form.CNROREF).innerHTML)?b.find("td").get(Form.CNROREF).innerHTML:"000",IMPORTE:b.find("td").get(Form.CIMPORTE).innerHTML,VUELTO:b.data("cambio")};f.push(c)});$.ajax({type:"post",dataType:"json",cache:false,url:"/Conc/Facturar",data:{codconc:c,nroane:d.nrodoc,desane:d.desane,refane:d.refane,tipdoc:e,vp:JSON.stringify(f)},success:function(a,b,c){if(App.isError(a.respuesta))alert(a.respuesta);if(App.isExito(a.respuesta)){printFactura($(Form.Tabla),d,a);if($(FormPago.PrintPreFact).is(":checked"))printPreFactura($(Form.Tabla),Form);$(Form.Und).val("");clearDesc(Form.PerDesc,Form.UndDesc);Anexo.clear($(Form.Anexo));resetTabla(Form.Tabla);window.location="/UndAtencion/Index"}},error:function(a,b){errorAjax(a,b)}});$(FormPago.Name).modal("hide")}else alert("ERROR: Para poder realizar la transacci\u00F3n los totales debe coincidir")}};var FormBuscar={BtnRuc:"#btn-buscar-ruc",BtnRazon:"#btn-buscar-razon",TxtBuscar:"#txtBuscar",Tabla:"#tabla-seleccionar-anexo"};$(document).ready(function(){Form.IGV=Form.getIGV();Form.initTipDocEmi();obtenerDetalle($(Form.Und),$(Form.Div).val(),Form.Tabla,Form.PerDesc,Form.UndDesc,function(a){});Anexo.initForm();$("#puntos-emision").val($("#punemi").text());$(Form.Div).on("change",function(){$(Form.Und).val("");Anexo.clear($(Form.Anexo));resetTabla(Form.Tabla);clearDesc(Form.PerDesc,Form.UndDesc)});$(Form.Und).keypress(function(a){if(13==a.which)changeUndAtencion($(this))});$(Form.Und).bind("accepted",function(a,b,c){changeUndAtencion($(this))});if("ACT"==$(App.ControlTeclado+":checked").val()){$("input[type='text']").keyboard();tecladoNumerico($("input[type='number']"))}$(".anexo").find(".anexo-nrodoc").bind("accepted",function(a,b,c){Anexo.getDB($(this).parent().parent())});$(".anexo").find(".anexo-nrodoc").keypress(function(a){if(13==a.which)Anexo.getDB($(this).parent().parent())});$(".btn-seleccionar-anexo").on("click",function(){$(".modal").modal("hide");var a=$(Form.FormSelAnexo);a.data("anexo",$(this).data("anexo"));a.modal("show")});$(".btn-clear-anexo").on("click",function(){Anexo.clear($(this).parent().parent().parent())});$(FormBuscar.BtnRazon+", "+FormBuscar.BtnRuc).on("click",function(){var a="/Anexos/BuscarNrodoc";if("razon"==$(this).data("val"))a="/Anexos/BuscarRazon";buscarAjax(a,$(FormBuscar.TxtBuscar).val(),$(FormBuscar.Tabla),["desane","tipdoc","nrodoc","refane"],function(a){var b=$(Form.FormSelAnexo);a.on("click",function(){var c=Form.InputGroupTDE+":checked";switch($(c).val()){case"01":if("RUC"!=a.find("td").get(1).innerHTML)return alert("ERROR: No puede colocar un "+a.find("td").get(1).innerHTML+" cuando el se emite una "+$(c).data("desc"));break;default:if("RUC"==a.find("td").get(1).innerHTML)return alert("ERROR: No puede colocar un "+a.find("td").get(1).innerHTML+" cuando el se emite una "+$(c).data("desc"))}var d={desane:a.find("td").get(0).innerHTML,nrodoc:a.find("td").get(2).innerHTML,refane:a.find("td").get(3).innerHTML};Anexo.show(d,$(b.data("anexo")));b.modal("hide")})})});$("#factura-btn-pagar").on("click",function(){var a=$(Form.Tabla);if(!Validar.Dato($(Form.Div).val()))return alert(Msg.SELECCION_UND);if(!Validar.Dato($(Form.Tabla).data("codigo")))return alert(Msg.SELECCION_DIV);if(a.find("tbody tr").length<=0)return alert(Msg.SIN_ELEMENTOS);if(!Validar.Anexo(Anexo.get($(Form.Anexo))))return alert(Msg.ANEXO_INVALIDO);FormPago.initForm();$(FormPago.Name).modal("show")});$("#cambiar-undatencion").on("click",function(){if(!Validar.Dato($(Form.Div).val()))return alert(Msg.SELECCIONE_DIV);if(!Validar.Dato($(Form.Tabla).data("codigo")))return alert(Msg.SELECCION_UND);$(Form.FormCambiarUnd).modal("show");$(Form.SelectCambiarDiv).val($(Form.Div).val());$(Form.SelectCambiarDiv).change()});$(Form.SelectCambiarDiv).on("change",function(){buscarAjax("/UndAtencion/ObtenerLibres",$(this).val(),$("#tabla-cambiar-undatencion"),["CODIGO","DESCRIPCION"],function(a){a.on("click",function(){if(confirm(MSG_DESEA_CAMBIAR_UNDATENCION)){var a=$(this).find("td").get(0).innerHTML;var b=$(Form.SelectCambiarDiv).val();var c=$(Form.Tabla).data("codigo");cambiarUndatencion(c,$(Form.Und),$(Form.Div),a,b,$(Form.UndDesc));$(Form.FormCambiarUnd).modal("hide")}})})});$("#factura-pre-factura").on("click",function(){if(!Validar.Dato($(Form.Div).val()))return alert(Msg.SELECCION_DIV);var a=$(Form.Tabla);if(!Validar.Dato(a.data("codigo")))return alert(Msg.SELECCION_UND);if(a.find("tbody tr").length<=0)return alert(Msg.SIN_ELEMENTOS);printPreFactura(a,Form)});$("#anular-factura").on("click",function(){if(!Validar.Dato($(Form.Div).val()))return alert(Msg.SELECCION_DIV);if(!Validar.Dato($(Form.Tabla).data("codigo")))return alert(Msg.SELECCION_UND);if(confirm(Msg.ANULAR_CONSUMO)){var a=$(Form.Tabla).data("codigo");$.ajax({type:"post",dataType:"json",cache:false,url:"/Conc/Anular",data:{codigo:a},success:function(a,b,c){if(App.isError(a.respuesta))return alert(a.respuesta);else{Anexo.clear($(Form.Anexo));resetTabla(Form.Tabla);$(Form.Und).val("");clearDesc(Form.PerDesc,Form.UndDesc);window.location="/UndAtencion/Index"}},error:function(a,b){errorAjax(a,b)}})}});$("#empleados li").on("click",function(){$(Form.FormSelPerAte).modal("hide");var a=$(this);$.ajax({type:"post",dataType:"json",cache:false,url:"/UndAtencion/Aperturar",data:{codigo:$(Form.Und).val(),idperatencion:$(this).data("codigo"),divate:$(Form.Div).val()},success:function(b,c,d){if(App.isError(b.respuesta))alert(b.respuesta);else{$(Form.Tabla).data("codigo",b.cabecera.CODIGO);$(Form.UndDesc).text(b.undatencion.DESCRIPCION);$(Form.UndDesc).data("codigo",b.undatencion.CODIGO);$(Form.PerDesc).data("codigo",$(this).data("codigo"));$(Form.PerDesc).text(a.data("desc"))}},error:function(a,b){errorAjax(a,b)}})});$("#factura-btn-guardar").on("click",function(){if(!Validar.Dato($(Form.Div).val()))return alert(Msg.SELECCION_DIV);if(!Validar.Dato($(Form.Tabla).data("codigo")))return alert(Msg.SELECCION_UND);guardarFactura($(Form.Tabla))});$(Form.GroupTipDocEmi+" .btn").on("click",function(){$(this).siblings(".btn").removeClass("active");$(this).addClass(Form.BtnTipDocEmi);$(this).children("input[type=radio]").prop("checked",true);var a=Anexo.get($(Form.Anexo));Anexo.show({nrodoc:a.nrodoc,refane:"",desane:""},$(Form.Anexo))});$(FormPago.GroupFV+" .btn").on("click",function(){$(this).siblings(".btn").removeClass(FormPago.BtnFV);$(this).addClass(FormPago.BtnFV);var a=$(this).children("input[type=radio]");a.prop("checked",true);$(FormPago.LblFV).text(a.data("desc"));FormPago.updateForm($(FormPago.InputGroupFP+":checked"))});$(FormPago.GroupFP+" .btn").on("click",function(){$(this).siblings(".btn").removeClass(FormPago.BtnFP);$(this).addClass(FormPago.BtnFP);var a=$(this).children("input[type=radio]");a.prop("checked",true);FormPago.updateForm(a)});$(Anexo.GroupTipDoc+" .btn").on("click",function(){$(this).siblings(".btn").removeClass(Anexo.BtnTipDoc);$(this).addClass(Anexo.BtnTipDoc);var a=$(this).children("input[type=radio]");a.prop("checked",true);Anexo.updateForm(a)});$(Anexo.GroupTipPer+" .btn").on("click",function(){$(this).siblings(".btn").removeClass(Anexo.BtnTipPer);$(this).addClass(Anexo.BtnTipPer);var a=$(this).children("input[type=radio]");a.prop("checked",true);Anexo.updateForm(a)});$("#form-pagar-btn-aceptar").on("click",function(){var a=parseFloat($("#forma-pago-total").text())<parseFloat($("#form-pagar-total").text());if(a)FormPago.add();var a=parseFloat($("#forma-pago-total").text())<parseFloat($("#form-pagar-total").text());if(!a)FormPago.aceptar()});$("#puntos-emision").on("change",function(){var a=$(this).val();$.ajax({type:"post",dataType:"json",cache:false,url:"/Punemi/Cambiar",data:{codigo:a},success:function(a,b,c){if(App.isError(a.respuesta))alert(a.respuesta)},error:function(a,b){errorAjax(a,b)}})});$(Anexo.BtnSubmit).on("click",function(){var a={};var b=$(Anexo.FormBody);a.nrodoc=b.find("#input-nrodoc").val();a.tipdoc=$(Anexo.InputGroupTD+":checked").val();a.refane=b.find("#input-refane").val();a.apepat=null!=b.find("#input-ape").val()?b.find("#input-ape").val().split(" ")[0]:null;a.apemat=null!=b.find("#input-ape").val()?b.find("#input-ape").val().split(" ")[1]:null;a.nombre1=b.find("#input-nom1").val();a.nombre2=b.find("#input-nom2").val();a.desane=b.find("#input-desane").val();if(!Validar.Anexo(a))return alert(Msg.ANEXO_INVALIDO);switch($(this).text()){case"Guardar":Anexo.createDB(a,$(Form.Anexo));break;case"Actualizar":Anexo.updateDB(a,$(Form.Anexo))}$(Form.FormAnexo).modal("hide")});$(".btn-actualizar-anexo").on("click",function(){Anexo.getDB($(Form.Anexo),function(a){Anexo.initForm(a.tipdoc);var b=$(Anexo.FormBody);b.find("#input-nrodoc").val(a.nrodoc);b.find("#input-refane").val(a.refane);null==a.apepat&&null==a.apemat?b.find("#input-ape").val(""):b.find("#input-ape").val(a.apepat+" "+a.apemat);b.find("#input-nom1").val(null==a.nombre1?"":a.nombre1);b.find("#input-nom2").val(null==a.nombre2?"":a.nombre2);b.find("#input-desane").val(null==a.desane?"":a.desane);$(Form.FormAnexo).find(Anexo.FormTitle).text("Actualizar Cliente");$(Form.FormAnexo).find(Anexo.BtnSubmit).text("Actualizar");$(Form.FormAnexo).modal("show")})});$(".seleccion-categoria").on("click",function(){var a=$(this).data("codigo");buscarConventaClaserv(a,$("#panel-productos-"+a),Form.Tabla)});$("#conventa-btn-buscar").on("click",function(){buscarConventaDescripcion($("#conventa-texto").val(),$("#panel-buscar"),Form.Tabla)});$("#conventa-texto").on("keyup",function(a){buscarConventaDescripcion($("#conventa-texto").val(),$("#panel-buscar"),Form.Tabla)});$("#conventa-texto").bind("accepted",function(a,b,c){buscarConventaDescripcion($("#conventa-texto").val(),$("#panel-buscar"),Form.Tabla)})});